<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/" 
      xmlns:i18n="http://genshi.edgewall.org/i18n"
      i18n:domain="acct_mgr">
  <xi:include href="admin.html" />
  <?python
    if _dgettext is not None:
        dgettext = _dgettext ?>
  <head>
    <title>Accounts: Cleanup</title>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        // Compatibility: The prop function doesn't exist before jQuery 1.6
        if(!$.isFunction($.fn.prop)) $.fn.prop = $.fn.attr;
        // Compatibility: The closest function doesn't exist before jQuery 1.3
        if(!$.isFunction($.fn.closest)) $.fn.closest = $.fn.parents;
        // Clear all the checkboxes, to cover the case that the user clicks
        // the Back button in the browser
        $("table.listing input:checkbox").prop("checked", false);
        // Disable the submit buttons until at least one checkboxes is checked
        function setButtonsDisabled() {
          var numChecked = $("table.listing tbody input:checkbox:checked").length;
          var noneChecked = numChecked === 0;
          $("#remove").attr("disabled", noneChecked);
        }
        setButtonsDisabled();
        // Add a "select all" checkbox to the header
        $("table.listing thead th.sel").html(
                '<input type="checkbox" title="Select all" />')
          .children()
          .click(function() {
            $(".sel input:checkbox", $(this).closest("table.listing"))
              .prop("checked", this.checked)
              .each(function() {
                  this.indeterminate = false;
              });
            setButtonsDisabled();
          });
        // Set the state of the "select all" checkbox
        function setGroupToggler() {
          var checkboxes = $("table.listing tbody input:checkbox");
          var numChecked = checkboxes.filter(":checked").length;
          var noneChecked = numChecked === 0;
          var allChecked = numChecked === checkboxes.length;
          $("table.listing thead th.sel input:checkbox")
            .prop("checked", allChecked)
            .each(function() {
              this.indeterminate = !(noneChecked || allChecked);
            });
        }
        // 'User' checkboxes toggle their 'attribute' checkboxes
        $("table.listing tbody th.sel input:checkbox").click(function() {
          $("td.sel input:checkbox", $(this).closest("tbody").next())
              .prop("checked", this.checked);
          setButtonsDisabled();
          setGroupToggler();
        });
        // 'Attribute' checkboxes toggle their 'user' checkbox with tri-state
        // behavior
        $("table.listing tbody td.sel input:checkbox").click(function() {
          var tbody = $(this).closest("tbody");
          var checkboxes = $("input:checkbox", tbody);
          var numChecked = checkboxes.filter(":checked").length;
          var noneChecked = numChecked === 0;
          var allChecked = numChecked === checkboxes.length;
          // Compatibility: the 'indeterminate' can't be set using jQuery's,
          // 'attr' function, so calling 'prop' wouldn't work with the
          // compatibility fix that was put in place for 'prop'
          $("th.sel input:checkbox", tbody.prev())
            .prop("checked", allChecked)
            .each(function() {
              this.indeterminate = !(noneChecked || allChecked);
            });
            setButtonsDisabled();
            setGroupToggler();
        });
      });
    </script>
  </head>

  <body>
    <h2>Accounts: Cleanup</h2>
    <form id="cleanup" class="mod" method="post">
      <div id="attributelist">
        <table class="listing" id="attributelist">
          <thead>
            <tr>
              <th class="sel">&nbsp;</th>
              <th colspan="3">Account</th>
            </tr>
            <tr>
              <th>&nbsp;</th>
              <th>&nbsp;</th>
              <th>Attribute</th>
              <th>Value</th>
            </tr>
          </thead>
          <!--!
          <tbody>
            <tr class="important">
              <td colspan="4">Not Authenticated Accounts</td>
            </tr>
          </tbody>
          <py:for each="account, states in attr">
            <py:for each="state in states['id'].keys()">
              <py:if test="state != 1">
                <tbody>
                  <tr>
                    <th><input type="checkbox" name="sel"
                               value="${states['id'][state]}" />
                    </th>
                    <th colspan="3">
                      '${account}'
                    </th>
                  </tr>
                </tbody>
                <tbody>
                  <tr py:for="name,value in states[state].iteritems()"
                      py:if="name != 'id' and not isinstance(value, dict)">
                    <td>&nbsp;</td>
                    <td>
                      <input type="checkbox" name="sel"
                             value="${states[state]['id'][name]}" />
                    </td>
                    <td>'${name}'</td> 
                    <td>'${value}'</td>
                  </tr>
                </tbody>
              </py:if>
            </py:for>
          </py:for>
          //-->
          <tbody>
            <tr class="suggestions">
              <td colspan="4">Authenticated Accounts</td>
            </tr>
          </tbody>
          <py:for each="account, states in attr.iteritems()">
            <py:if test="True">
              <tbody>
                <tr>
                  <th class="sel">
                    <input type="checkbox" name="sel"
                           value="${states['id'][1]}" />
                  </th>
                  <th colspan="3">
                    '${account}'
                  </th>
                </tr>
              </tbody>
              <tbody>
                <tr py:for="name,value in states[1].iteritems()"
                    py:if="name != 'id' and not isinstance(value, dict)">
                  <td>&nbsp;</td>
                  <td class="sel">
                    <input type="checkbox" name="sel"
                           value="${states[1]['id'][name]}" />
                  </td>
                  <td>'${name}'</td>
                  <td>'${value}'</td>
                </tr>
              </tbody>
            </py:if>
          </py:for>
        </table>
      </div>
      <div class="buttons">
        <input type="hidden" name="max_per_page"
               value="$max_per_page" />
        <input type="hidden" name="accounts"
               value="${','.join(accounts)}" />
        <input type="submit" id="remove" name="purge"
               value="${dgettext('acct_mgr', 'Remove selected entries')}" />
      </div>
    </form>
  </body>
</html>
