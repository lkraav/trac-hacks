<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:py="http://genshi.edgewall.org/" py:strip="">
  <xi:include href="layout.html"/>
  <xi:include href="macros.html"/>
  <xi:include href="discussion-macros.html"/>
  <head>
    <title>Message List</title>
    <script type="text/javascript">
      $(document).ready(function() {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor("Link to this section");
      });
    </script>
  </head>

  <?python
    from trac.wiki.formatter import format_to_oneliner
    from trac.util.datefmt import format_datetime, pretty_timedelta
  ?>

  <body>
    <xi:include href="discussion-header.html"/>

    <div id="content" class="discussion searchable">
      <div id="${discussion.mode}" class="${discussion.mode}">

        <h1>${format_to_oneliner(discussion.env, context, discussion.forum.name)} (#${discussion.forum.id}) - ${format_to_oneliner(discussion.env, context, discussion.topic.subject)} (#${discussion.topic.id}) - Message List</h1>

        ${display_discussion(discussion, href.discussion('topic', discussion.topic.id))}

        <div py:if="(('DISCUSSION_MODERATE' in perm) and discussion.moderator)
          or ((discussion.authname == discussion.topic.author) and (not 'locked'
          in discussion.topic.status) and (discussion.authname != 'anonymous'))"
          class="moderation">
          <h3>Moderation</h3>
          <div class="buttons">
            <form method="post" action="${href.discussion('topic', discussion.topic.id)}">
              <div>
                <py:if test="'DISCUSSION_MODERATE' in perm and discussion.moderator">
                  <label for="important">
                    <input py:if="discussion.topic.priority > 0" type="checkbox"
                      name="important" id="important" checked="yes" value="1"
                      onchange="change_attribute('${href.discussion('ajax',
                        'topic', discussion.topic.id)}', 'important',
                        this.checked);"/>
                    <input py:if="not (discussion.topic.priority > 0)" type="checkbox"
                      name="important" id="important" value="0"
                      onchange="change_attribute('${href.discussion('ajax',
                        'topic', discussion.topic.id)}', 'important',
                        this.checked);"/>
                    Make topic important (listed at the top).
                  </label><br/>
                </py:if>
                <label for="solved">
                  <input py:if="'solved' in discussion.topic.status" type="checkbox"
                    name="solved" id="solved" checked="yes" value="1"
                    onchange="change_attribute('${href.discussion('ajax',
                      'topic', discussion.topic.id)}', 'status.solved',
                      this.checked);"/>
                  <input py:if="not 'solved' in discussion.topic.status" type="checkbox"
                    name="solved" id="solved" value="0"
                    onchange="change_attribute('${href.discussion('ajax',
                      'topic', discussion.topic.id)}', 'status.solved',
                      this.checked);"/>
                  Solve topic.
                </label><br/>
                <py:if test="'DISCUSSION_MODERATE' in perm and discussion.moderator">
                  <label py:if="'DISCUSSION_MODERATE' in perm and discussion.moderator" for="locked">
                    <input py:if="'locked' in discussion.topic.status" type="checkbox"
                      name="locked" id="locked" checked="yes" value="1"
                      onchange="change_attribute('${href.discussion('ajax',
                        'topic', discussion.topic.id)}', 'status.locked',
                        this.checked); lock_topic(this.checked);"/>
                    <input py:if="not 'locked' in discussion.topic.status" type="checkbox"
                      name="locked" id="locked" value="0"
                      onchange="change_attribute('${href.discussion('ajax',
                        'topic', discussion.topic.id)}', 'status.locked',
                        this.checked); lock_topic(this.checked);"/>
                    Lock topic.
                  </label>
                </py:if>
                <input type="hidden" name="discussion_action" value="edit-attribute"/>
              </div>
            </form><br/>
            <form method="post" action="${href.discussion('topic', discussion.topic.id)}">
              <div>
                <input type="submit" name="deletetopic" value="Delete topic" onclick="return confirm('Do you realy want to delete this topic?')"/>
                <input type="hidden" name="discussion_action" value="delete"/>
              </div>
            </form>
            <form method="post" action="${href.discussion('topic', discussion.topic.id)}">
              <div >
                <input type="submit" name="movetopic" value="Move topic"/>
                <input type="hidden" name="discussion_action" value="move"/>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
