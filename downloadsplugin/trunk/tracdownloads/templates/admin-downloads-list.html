# extends 'admin.html'
# import "downloads-macros.html" as dmacros

<!DOCTYPE html>
<html>
  <head>
    <title>
      # block title
      #   if title:
      Downloads ${ super() }
      #   endif
      # endblock title
    </title>

    # block head
    ${ super() }
    # endblock head
  </head>

  <body>
    # block content
    <h2>Downloads</h2>
    <form class="addnew" enctype="multipart/form-data" method="post" action="${panel_href()}">
      ${jmacros.form_token_input()}
      <fieldset>
        <legend>
        # if downloads.download.id:
              Edit Download:
        # else:
              Add Download:
        # endif
        </legend>

        # if not downloads.download.id:
        <div class="field">
          <label for="file">File:</label><br/>
          <input type="file" id="file" name="file" /><br/>
        </div>
        # endif

        <div class="field">
          <label for="description">Description:</label><br/>
          <input type="text" id="description" name="description" value="${downloads.download.description}"/><br/>
        </div>

        # if downloads.has_tags:
        <div class="field">
          <label for="tags">Additional Tags:</label><br/>
          <input type="text" id="tags" name="tags" value="${downloads.download.tags}"/><br/>
        </div>
        # endif

        <div class="component">
          <label for="component">Component:</label><br/>
          <select id="component" name="component">
            # for component in downloads.components:
            #  if downloads.download.component == component.name:
                <option value="${component.name}" selected="selected">${component.name}</option>
            #  else:
                <option value="${component.name}">${component.name}</option>
            #  endif
            # endfor
          </select><br/>
        </div>

        <div class="version">
          <label for="version">Version:</label><br/>
          <select id="version" name="version">
            # for version in downloads.versions:
            #  if downloads.download.version == version.name:
                <option value="${version.name}" selected="selected">${version.name}</option>
            #  else:
                <option value="${version.name}">${version.name}</option>
            #  endif
            # endfor
          </select><br/>
        </div>

        <div class="architecture">
          <label for="architecture">Architecture:</label><br/>
          <select id="architecture" name="architecture">
            # for architecture in downloads.architectures:
            #  if downloads.download.architecture == architecture.id:
                <option value="${architecture.id}" selected="selected">${architecture.name}</option>
            #  else:
                <option value="${architecture.id}">${architecture.name}</option>
            #  endif
            # endfor
          </select><br/>
        </div>

        <div class="platform">
          <label for="platform">Platform:</label><br/>
          <select id="platform" name="platform">
            # for platform in downloads.platforms:
            #  if downloads.download.platform == platform.id:
                <option value="${platform.id}" selected="selected">${platform.name}</option>
            #  else:
                <option value="${platform.id}">${platform.name}</option>
            #  endif
            # endfor
          </select><br/>
        </div>

        <div class="type">
          <label for="type">Type:</label><br/>
          <select id="type" name="type">
            # for type in downloads.types:
            #  if downloads.download.type == type.id:
                <option value="${type.id}" selected="selected">${type.name}</option>
            #  else:
                <option value="${type.id}">${type.name}</option>
            #  endif
            # endfor
          </select><br/>
        </div>

        <div class="buttons">
          # if downloads.download.id:
              <input type="submit" name="submit" value="Edit"/>
              <input type="button" name="cancel" value="Cancel" onclick="location.href = '${panel_href()}?order=${downloads.order};desc=${downloads.desc}'"/>
              <input type="hidden" name="id" value="${downloads.download.id}"/>
              <input type="hidden" name="action" value="post-edit"/>
          # else:
              <input type="submit" name="submit" value="Add"/>
              <input type="hidden" name="action" value="post-add"/>
          # endif
          <input type="hidden" name="order" value="${downloads.order}"/>
          <input type="hidden" name="desc" value="${downloads.desc}"/>
        </div>
      </fieldset>
    </form>

    # if len(downloads.downloads) > 0:
        <form id="downloads_table" method="post" action="${panel_href()}?order=${downloads.order};desc=${downloads.desc}">
          ${jmacros.form_token_input()}
          <table class="listing">
            <thead>
              <tr>
                <th class="sel"> </th>
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'id', 'ID', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'file', 'File', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'description', 'Description', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'size', 'Size', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'time', 'Uploaded', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'count', 'Downloads', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'author', 'Uploader', panel_href())}
            # if downloads.has_tags:
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'tags', 'Tags', panel_href())}
            # endif
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'component', 'Component', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'version', 'Version', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'architecture', 'Architecture', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'platform', 'Platform', panel_href())}
                ${dmacros.sortable_th(downloads.order, downloads.desc, 'type', 'Type', panel_href())}
              </tr>
            </thead>
            <tbody>
          # for download in downloads.downloads:
                <tr class="${loop.index0 % 2 and 'even' or 'odd'}">
                  <td class="sel">
                    <input type="checkbox" name="selection" value="${download.id}"/>
                  </td>

                  <td class="id">
                    <div class="id">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.id}
                      </a>
                    </div>
                  </td>

                  <td class="file">
                    <div class="file">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.file}
                      </a>
                    </div>
                  </td>

                  <td class="description">
                    <div class="description">
                      ${wiki_to_oneliner(context(parent), download.description)}
                    </div>
                  </td>

                  <td class="size">
                    <div class="size">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${pretty_size(download.size)}
                      </a>
                    </div>
                  </td>

                  <td class="time">
                    <div class="time">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${format_datetime(download.time)}<br/>(${pretty_timedelta(download.time)} ago)
                      </a>
                    </div>
                  </td>

                  <td class="count">
                    <div class="count">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.count or '0'}
                      </a>
                    </div>
                  </td>

                  <td class="author">
                    <div class="author">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.author}
                      </a>
                    </div>
                  </td>

            # if downloads.has_tags:
                  <td class="tags">
                    <div class="tags">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.tags}
                      </a>
                    </div>
                  </td>
            # endif

                  <td class="component">
                    <div class="component">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.component}
                      </a>
                    </div>
                  </td>

                  <td class="version">
                    <div class="version">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.version}
                      </a>
                    </div>
                  </td>

                  <td class="architecture">
                    <div class="architecture">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.architecture.name}
                      </a>
                    </div>
                  </td>

                  <td class="platform">
                    <div class="platform">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.platform.name}
                      </a>
                    </div>
                  </td>

                  <td class="type">
                    <div class="type">
                      <a href="${panel_href(download.id)}?order=${downloads.order};desc=${downloads.desc}">
                        ${download.type.name}
                      </a>
                    </div>
                  </td>
                </tr>
          # endfor
            </tbody>
          </table>

          <div class="buttons">
            <input type="submit" name="remove" value="Remove selected items" />
            <input type="hidden" name="action" value="delete"/>
          </div>
        </form>
    # else:
        <p class="help">As long as you don't add any items to the list, this field will remain completely hidden from the user interface.</p>
        <br style="clear: right"/>
    # endif

    # endblock content
  </body>
</html>
