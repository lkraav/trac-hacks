<!--!
  Copyright (C) 2015 Jon Ashley <trac@zelatrix.plus.com>
  All rights reserved.

  Copyright (C) 2012 Rob Guttman <guttman@alum.mit.edu>
  All rights reserved.

  This software is licensed as described in the file COPYING, which
  you should have received as part of this distribution.
-->

<script type="text/javascript" language="javascript"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/" py:strip="">

var prepare = function(){
    var selector = jQuery('${selector}');
    
    // prepare data from a local table or remote query
    if ('${source}' == 'table'){
        var data = [];
        var labels = [];
        populate(selector, labels, data);
        draw(selector, labels, data, {${options}});
    } else {
        // Completely untested since conversion to dygraphs;
        // don't expect this to work yet.
        var query;
        if ('${query}'.length)
            query.setQuery('${query}');
        query.send(function(response) {
            if (!response.isError()) {
                var data = response.getDataTable();
                var labels = data.shift();
                draw(selector, labels, data, {${options}});
            }
        });
    }
}

jQuery(document).ready(function(){
    prepare();
});

</script>
