<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
  <xi:include href="admin.html" />
  <head>
    <title>Import/Export Excel</title>
  </head>

  <body>
    <h2>Import/Export Excel</h2>
      <form method="POST">
        <fieldset>
            <legend>Configuration</legend>
            <table class="listing" id="cflist">
              <thead>
                <tr>
                  <th width="20">Weight</th>
                  <th>Name</th>
                  <th>Label</th>
                  <th>Excel Type</th>
                  <th>Exportable</th>
                  <th>Importable</th>
                </tr>
              </thead>
              <tbody>
                <tr py:for="fd in sorted( defaultfields + customfields, key = lambda a : fieldsWeight[a.name] )">
                  <td>
                      <input style="width:20pt;" name="${fd.name}.weight" type="text" value="${fieldsWeight[fd.name]}" />
                  </td>
                  <td>${fd.name}</td>
                  <td>${fd.label}</td>
                  <td>
                    <py:choose test="">
                      <py:when test="fd in defaultfields">
                        ${fieldsFormat[fd.name]}
                      </py:when>
                      <py:otherwise>
                        <select name="${fd.name}.format">
                          <py:for each="fmt in formats">
                            <py:choose test="">
                              <py:when test="fieldsFormat[fd.name] == fmt">
                                <option selected='selected' value="${fmt}" 
                                        py:content="fmt">
                                </option>
                              </py:when>
                              <py:otherwise>
                                <option value="${fmt}" py:content="fmt"></option>
                              </py:otherwise>
                            </py:choose>
                          </py:for>
                        </select>
                      </py:otherwise>
                    </py:choose>
                  </td>
                  <td>
                    <py:choose test="">
                      <input py:when="fd in defaultfields and fd.name in exportForced" checked="checked" disabled="disabled" name="${fd.name}.export" type="checkbox" value="True" />
                      <input py:when="fieldsExport[fd.name] == True" checked="checked" name="${fd.name}.export" type="checkbox" value="True" />
                      <input py:otherwise="" name="${fd.name}.export" type="checkbox" value="True" />
                    </py:choose>
                  </td>
                  <td>
                    <py:choose test="">
                      <input py:when="fd in defaultfields and fd.name in importForbidden" disabled="disabled" name="${fd.name}.import" type="checkbox" value="True" />
                      <input py:when="fieldsImport[fd.name] == True" checked="checked" name="${fd.name}.import" type="checkbox" value="True" />
                      <input py:otherwise="" name="${fd.name}.import" type="checkbox" value="True" />
                    </py:choose>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <div class="buttons">
              <input type="submit" name="save" value="Save" />
            </div>
        </fieldset>
    </form>

    <form method="POST">
        <fieldset>
            <legend>Export</legend>
            <div>
                <table style="border:0px;">
                    <thead>
                        <th py:if="len(types)>0">${[fd.label for fd in defaultfields if fd.name == 'type'][0]}</th>
                        <th py:if="len(versions)>0">${[fd.label for fd in defaultfields if fd.name == 'version'][0]}</th>
                        <th py:if="len(milestones)>0">${[fd.label for fd in defaultfields if fd.name == 'milestone'][0]}</th>
                        <th py:if="len(components)>0">${[fd.label for fd in defaultfields if fd.name == 'component'][0]}</th>
                        <th py:if="len(status)>0">${[fd.label for fd in defaultfields if fd.name == 'status'][0]}</th>
                        <th py:if="len(priorities)>0">${[fd.label for fd in defaultfields if fd.name == 'priority'][0]}</th>
                        <th py:if="len(severities)>0">${[fd.label for fd in defaultfields if fd.name == 'severity'][0]}</th>
                        <th py:if="len(resolutions)>0">${[fd.label for fd in defaultfields if fd.name == 'resolution'][0]}</th>
                    </thead>
                    <tbody>
                        <td py:if="len(types)>0" style="border-top:0px;border-left:0px;border-bottom:0px;border-right:1px dotted black;">
                            <select name="filter.type" multiple="multiple" size="5">
                                <option py:for="type in types"
                                        value="${type}" py:content="type">
                                </option>
                            </select>
                        </td>
                        <td py:if="len(versions)>0" style="border-top:0px;border-left:0px;border-bottom:0px;border-right:1px dotted black;">
                            <select name="filter.version" multiple="multiple" size="5">
                                <option py:for="version in versions"
                                        value="${version}" py:content="version">
                                </option>
                            </select>
                        </td>
                        <td py:if="len(milestones)>0" style="border-top:0px;border-left:0px;border-bottom:0px;border-right:1px dotted black;">
                            <select name="filter.milestone" multiple="multiple" size="5">
                                <option py:for="m in milestones"
                                        value="${m}" py:content="m">
                                </option>
                            </select>
                        </td>
                        <td py:if="len(components)>0" style="border-top:0px;border-left:0px;border-bottom:0px;border-right:1px dotted black;">
                            <select name="filter.component" multiple="multiple" size="5">
                                <option py:for="component in components"
                                        value="${component}" py:content="component">
                                </option>
                            </select>
                        </td>
                        <td py:if="len(status)>0" style="border-top:0px;border-left:0px;border-bottom:0px;border-right:1px dotted black;">
                            <select name="filter.status" multiple="multiple" size="5">
                                <option py:for="stat in status"
                                        value="${stat}" py:content="stat">
                                </option>
                            </select>
                        </td>
                        <td py:if="len(priorities)>0" style="border-top:0px;border-left:0px;border-bottom:0px;border-right:1px dotted black;">
                            <select name="filter.priority" multiple="multiple" size="5">
                                <option py:for="prior in priorities"
                                        value="${prior}" py:content="prior">
                                </option>
                            </select>
                        </td>
                        <td py:if="len(severities)>0" style="border-top:0px;border-left:0px;border-bottom:0px;border-right:1px dotted black;">
                            <select name="filter.severity" multiple="multiple" size="5">
                                <option py:for="sever in severities"
                                        value="${sever}" py:content="sever">
                                </option>
                            </select>
                        </td>
                        <td py:if="len(resolutions)>0" style="border:0px;">
                            <select name="filter.resolution" multiple="multiple" size="5">
                                <option py:for="res in resolutions"
                                        value="${res}" py:content="res">
                                </option>
                            </select>
                        </td>
                    </tbody>
                </table>
            </div>
            <div>
                <input checked="checked" name="export.statistics" type="checkbox" value="True" /> With statistics sheet (needs type, milestone and status colomns)<br />
                <input name="export.changeset" type="checkbox" value="True" /> With all comments in tickets changet set
            </div>
            <div class="buttons">
                <input type="submit" name="export" value="Export Tickets" />
            </div>
        </fieldset>
    </form>
    <form method="POST" enctype="multipart/form-data">
        <fieldset>
            <legend>Import</legend>
            <div class="buttons">
                <label for="import-file">File to import:</label>
                <input type="file" name="import-file" />
                <br /> <br />
                <input type="submit" name="import_preview" value="Import Tickets (Preview)" />
            </div>
        </fieldset>
    </form>
  </body>

</html>
