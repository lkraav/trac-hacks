<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="layout.html" />
  <head>
    <title>Code Review Details - ${review.name}</title>
  </head>
<body>

  <h1>Code Review Details - ${review.name}</h1>
      <dl class="overview">
          <dt>Name:</dt><dd>${review.name}</dd>
          <dt>Status:</dt><dd>${review.status}</dd>
          <dt>ID:</dt><dd>$review.review_id</dd>
          <dt>Author:</dt><dd>${review.author}</dd>
          <dt>Creation Date:</dt><dd>${review.creation_date}</dd>
      </dl>
     <dl py:if="review.notes" class="overview">
          <dt>Author notes:</dt><dd>$review.html_notes</dd>
     </dl>
  <div py:if="parent_review">
      <h2>Followup Review from:</h2>
      <dl class="overview">
          <dt>Name:</dt><dd>${parent_review.name}</dd>
          <dt>Status:</dt><dd>${parent_review.status}</dd>
          <dt>ID:</dt><dd>$parent_review.review_id</dd>
          <dt>Author:</dt><dd>${parent_review.author}</dd>
          <dt>Creation Date:</dt><dd>${parent_review.creation_date}</dd>
      </dl>
  </div>

  <h2>Files associated with this code review</h2>
  <p py:if="parent_review">The files will be compared with those from review
      <a href="peerReviewView?Review=$parent_review.review_id">#$parent_review.review_id</a>.</p>

  <table class="listing" id="filelist">
      <thead>
      <tr>
          <th>File ID</th>
          <th>Filename</th>
          <th>Revision</th>
          <th>Line Numbers</th>
          <th># of Comments</th>
      </tr>
      </thead>
      <tbody py:with="cls=cycle(('odd', 'even'))">
      <tr py:if="not review_files" class="even" colspan="5">
          <td>There are no files included in this code review.</td>
      </tr>
      <tr py:for="item in review_files" class="${cls.next()}" id="$item.element_id">
          <td><a href="${href.peerReviewPerform()}?IDFile=${item.file_id}">${item.file_id}</a></td>
          <td><a href="${href.peerReviewPerform()}?IDFile=${item.file_id}">${item.path}</a></td>
          <td><a href="${href.peerReviewPerform()}?IDFile=${item.file_id}">${item.version}</a></td>
          <td py:if="item.start != 0"><a href="${href.peerReviewPerform()}?IDFile=${item.file_id}">${item.start} - ${item.end}</a></td>
          <td py:if="item.start == 0"><a href="${href.peerReviewPerform()}?IDFile=${item.file_id}">1 - End of file</a></td>
          <td><a href="${href.peerReviewPerform()}?IDFile=${item.file_id}">${item.num_comments}</a></td>
      </tr>
      </tbody>
  </table>


  <h2>Users assigned to this code review</h2>

  <!--! <xi:include href="user_list.html" /> -->

  <table py:if="review.author == req.authname or manager" class="listing" id="userlist">
    <thead>
      <tr>
        <td>User name</td>
        <td>Vote</td>
      </tr>
    </thead>
    <tbody py:with="cls=cycle(('odd', 'even'))">
      <tr py:if="rvsLength == 0" class="even">
        <td>There are no users included in this code review.</td>
      </tr>
      <tr py:if="review_files" py:for="item in rvs" class="${cls.next()}">
        <td>${item[0]}</td>
        <td>${item[1]}</td>
      </tr>
    </tbody>
  </table>

  <table py:if="review.author != req.authname and not manager" class="listing" id="userlist">
    <thead>
      <tr>
        <td>User name</td>
      </tr>
    </thead>
    <tbody py:with="cls=cycle(('odd', 'even'))">
      <tr py:if="rvsLength == 0" class="even">
        <td>There are no users included in this code review.</td>
      </tr>
      <tr py:if="rvsLength > 0" py:for="item in rvs" class="${cls.next()}">
        <td>${item[0]}</td>
      </tr>
    </tbody>
  </table>

  <py:if test="viewvotesummary">
  <h2>Vote summary</h2>
  <table width = "35%" id="vote-summary">
    <tr>
      <td>Vote tally:</td>
      <td class="yes">Yes: $votes.yes</td>
      <td class="no">No: $votes.no</td>
      <td class="pending">Pending: $votes.pending</td>
    </tr>
    <tr py:if="canivote">
      <td>Your vote is:</td>
      <td>
          <py:if test="myvote == -1">Pending</py:if>
          <py:if test="myvote == 0"><span style="color:red">No</span></py:if>
          <py:if test="myvote == 1"><span style="color:limegreen">Yes</span></py:if>
      </td>
        <td></td>
        <td></td>
    </tr>
  </table>
  </py:if>

  <py:if test="canivote and review.status != 'Closed' and review.status !=  'Ready for inclusion'">
  <h2>${myvote != -1 and 'Modify' or 'Cast'} your vote:</h2>
    <form action="" method="post">
      <fieldset>
        <div class="buttons">
          <input type="hidden" value="${review.review_id}" name="Review"/>
          <input type="submit" value="Approve" name="approved"/>
          <input type="submit" value="Don't approve" name="notapproved"/>
        </div>
      </fieldset>
    </form>
  </py:if>

  <py:if test="manager">
      <h2>Manager privileges</h2>
      <p>Change code review status:</p>

    <form method="post" action="">
      <fieldset>
        <input type="hidden" value="${review.review_id}" name="Review" />
        <select name="ManagerChoice" id="ManagerChoice_">
          <option value="Open for review">Open for review</option>
          <option value="Reviewed">Reviewed</option>
          <option value="Ready for inclusion">Ready for inclusion</option>
          <option value="Closed">Closed</option>
        </select>
        <input type="submit" name="submitbutton" value="Change Status" />
      </fieldset>
    </form>

      <!--!
    <form action="" method="post">
      <fieldset>
          <input type="hidden" value="${review.review_id}" name="Review" />
          <div class="buttons">
              <input type="submit" value="Resubmit For Review" name="resubmit"/>
          </div>
          <p class="help">When resubmitting all the data of this review will be used for prefilling the fields of a new code review.
              Comments will be stripped in the process. When the new review is finally created this one will be closed
              automatically.
          </p>
      </fieldset>
    </form> -->
  </py:if>

  <py:if test="manager or review.author == req.authname">

  <h2>Actions</h2>
    <form action="" method="post">
      <fieldset>
        <div class="buttons">
          <input type="hidden" value="${review.review_id}" name="Review"/>
          <input py:if="review.status != 'Ready for inclusion' and review.status != 'Closed'"
                 type="submit" value="Submit For Inclusion" name="inclusion"
                 disabled="${review.status != 'Reviewed' and 'true' or None}" />
          <input py:if="review.status != 'Closed'" type="submit" value="Close This Code Review" name="close"/>
          <input type="submit" value="Resubmit For Review" name="resubmit"/>
          <input type="submit" value="Followup Review" name="followup"/>
          <input py:if="review.status != 'Closed'" type="submit" value="Modify" name="modify"/>
        </div>
          <p class="help">When resubmitting all the data of this review will be used for prefilling the fields of a new code review.
              Comments will not be copied. When the new review is created this one will be closed
              automatically.
          </p>
          <p class="help">When creating a <strong>Followup Review</strong> all the data of this review will be used
              for prefilling the fields of a new code review. Comments will not be copied. During the new review it
              is possible to view the changes between file data at different revisions.
          </p>
      </fieldset>
    </form>
  </py:if>

</body>

</html>
