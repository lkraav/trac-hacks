diff -urN trac-trunk/trac/db/postgres_backend.py trac-trunk-aw/trac/db/postgres_backend.py
--- trac-trunk/trac/db/postgres_backend.py	2006-03-18 07:22:02.091778000 -0800
+++ trac-trunk-aw/trac/db/postgres_backend.py	2006-03-20 14:34:06.365700719 -0800
@@ -20,6 +20,7 @@
 
 psycopg = None
 PgSQL = None
+PGSchemaError = None
 
 
 class PostgreSQLConnector(Component):
@@ -38,6 +39,9 @@
                 params={}):
         cnx = self.get_connection(path, user, password, host, port, params)
         cursor = cnx.cursor()
+        if cnx.schema:
+            cursor.execute('CREATE SCHEMA %s' % cnx.schema)
+            cursor.execute('SET search_path TO %s, public', (cnx.schema,))
         from trac.db_default import schema
         for table in schema:
             for stmt in self.to_sql(table):
@@ -76,6 +80,7 @@
         # We support both psycopg and PgSQL but prefer psycopg
         global psycopg
         global PgSQL
+        global PGSchemaError
         global have_psycopg2
         
         if not psycopg and not PgSQL:
@@ -83,13 +88,16 @@
                 try:
                     import psycopg2 as psycopg
                     import psycopg2.extensions
+                    from psycopg2 import ProgrammingError as PGSchemaError
                     psycopg2.extensions.register_type(psycopg2.extensions.UNICODE)
                     have_psycopg2 = True
                 except ImportError:
                     have_psycopg2 = False
                     import psycopg
+                    from psycopg import ProgrammingError as PGSchemaError
             except ImportError:
                 from pyPgSQL import PgSQL
+                from pyPgSQL.libpq import OperationalError as PGSchemaError
         if psycopg:
             dsn = []
             if path:
@@ -107,6 +115,13 @@
                 cnx.set_client_encoding('UNICODE')
         else:
             cnx = PgSQL.connect('', user, password, host, path, port)
+        try:
+            self.schema = None
+            if 'schema' in params:
+                self.schema = params['schema']
+            cnx.cursor().execute('SET search_path TO %s, public', (self.schema,))
+        except PGSchemaError:
+            cnx.rollback()
         ConnectionWrapper.__init__(self, cnx)
 
     def cast(self, column, type):
@@ -121,3 +136,14 @@
     def get_last_id(self, cursor, table, column='id'):
         cursor.execute("SELECT CURRVAL('%s_%s_seq')" % (table, column))
         return cursor.fetchone()[0]
+
+    def cursor(self):
+        cursor = self.cnx.cursor()
+        if self.schema:
+            try:
+                cursor.execute("SET search_path TO %s, public", (self.schema,))
+                self.cnx.commit()
+            except PGSchemaError:
+                self.cnx.rollback()
+        return cursor
+
