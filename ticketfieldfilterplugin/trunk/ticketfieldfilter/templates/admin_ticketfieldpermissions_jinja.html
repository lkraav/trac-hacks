{#
# Copyright (C) 2021 Cinc
#
# All rights reserved.
#
# License: 3-clause BSD
#}
# extends 'admin.html'
<!DOCTYPE html>
<html>
    <head>
        <title>
          # block admintitle
          ${_("Field Permissions")}
          # endblock admintitle
        </title>
        # block head
        ${ super() }
        # endblock head
    </head>
    <body>
        # block adminpanel
        <h2>Ticket Field Permissions for <strong>${tkt_type}</strong></h2>
        <div id="content">
            # if len(all_fields) != len(tkt_fields[tkt_type]):
            <p>The following fields are disabled for ticket type <strong>${tkt_type}</strong> and not shown here.</p>
            <ul>
                # for key, val in all_fields:
                #     if key not in tkt_fields[tkt_type]:
                <li>${val}</li>
                #     endif
                # endfor
            </ul>
            # endif
            <div>
                # for key, val in all_fields:
                #     if key in tkt_fields[tkt_type]:
                <form action="" id="${key}_form" method="post" class="field-form">
                    ${jmacros.form_token_input()}
                    <fieldset>
                        <legend>${val}</legend>
                        <div class="field">
                            <table class="listing">
                                <thead>
                                <tr>
                                    <th>${_("Permissions")}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>
                                        # for perm in all_perms:
                                        <label class="field_label">
                                            <input name="sel" value="${perm}" type="checkbox"
                                                   ${{"checked": perm in field_perms[key]}|htmlattr}/>
                                            <span title="${perm}">${perm}</span>
                                        </label>
                                        # endfor
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <p class="help">The ticket field will be hidden if the user doesn't have the permissions
                                selected here. Leave all permissions unselected to disable permission checks.</p>
                        </div>
                        <div class="field">
                            <input type="hidden" name="type" value="${tkt_type}"/>
                            <input type="hidden" name="field" value="${key}"/>
                            <input name="cancel" value="${_('Cancel')}" id="${type}_cancel" type="submit"/>
                            <input name="save" value="${_('Save')}" id="${type}_save" type="submit" class="save-button"/>
                        </div>
                    </fieldset>
                </form>
                #     endif
                # endfor
            </div>
        </div>
        # endblock
    </body>
</html>
