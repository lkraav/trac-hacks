<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:i18n="http://genshi.edgewall.org/i18n">
  <xi:include href="layout.html" />
  <xi:include href="macros.html" />

<div id="content" class="ticket" py:with="preview_mode = 'preview' in req.args">
  <h1>New Project Pitch<span py:if="preview_mode and ticket.type" class="status">(${ticket.type})</span></h1>

  <!-- Do not show the ticket (pre)view when the user first comes to the "New Ticket" page.
       Wait until they hit preview. -->
  <fieldset id="preview" py:strip="not preview_mode">
    <py:if test="preview_mode">
      <legend>Preview (<a href="#properties">skip</a>)</legend>
      
      <!-- Preview of ticket changes -->
      <div py:if="change_preview" id="ticketchange" class="ticketdraft">
        <h3 class="change" id="${'cnum' in change_preview and 'comment:%d' % change_preview.cnum or None}">
          <span class="threading" py:if="'replyto' in change_preview">
            in reply to: ${commentref('&darr;&nbsp;', change_preview.replyto)}
          </span>
          Changed by ${authorinfo(change_preview.author)}
        </h3>
        ${display_change(change_preview)}
      </div>
    </py:if>

    <!-- Ticket Box (ticket fields along with description) -->
    <div id="ticket" py:if="preview_mode"
         class="${preview_mode and 'ticketdraft' or None}">
      <div class="date">
        <p><i>(ticket not yet created)</i></p>
      </div>

      <!-- use a placeholder if it's a new ticket -->
      <table class="properties"
             py:with="fields = [f for f in fields if not f.skip and f.name
                      not in ('type', 'owner')]">
        <tr>
          <th id="h_reporter">Reported by:</th>
          <td headers="h_reporter" class="searchable">
            ${defined('reporter_link') and reporter_link or authorinfo(ticket.reporter)}
          </td>
          <th id="h_owner">Owned by:</th>
          <td headers="h_owner">
            ${defined('owner_link') and owner_link or authorinfo(ticket.owner)}
          </td>
        </tr>

        <tr py:for="row in group(fields, 1, lambda f: f.type != 'textarea')"
            py:with="fullrow = len(row) == 1">
          <py:for each="idx, field in enumerate(row)">
            <th py:if="idx == 0 or not fullrow"
                id="${field and 'h_'+field.name or None}">
              <py:if test="field">${field.label or field.name}:</py:if>
            </th>
            <td py:if="idx == 0 or not fullrow"
                headers="${field and 'h_'+field.name or None}"
                class="${field and field.name in ('cc', 'keywords') and 'searchable' or None}"
                colspan="${fullrow and 3 or None}">
              <py:if test="field">
                <py:choose test="">
                  <py:when test="'rendered' in field">${field.rendered}</py:when>
                  <py:otherwise>${ticket[field.name]}</py:otherwise>
                </py:choose>
              </py:if>
            </td>
          </py:for>
        </tr>
      </table>
      <div class="description">
        <h3 id="comment:description">
          Description
          <span py:if="description_change" class="lastmod"
                title="$description_change.date">
                  (last modified by ${authorinfo(description_change.author)})
                  (<a href="${href.ticket(ticket.id, action='diff', version=description_change.cnum)}">diff</a>)
          </span>
        </h3>
        
        <div py:if="ticket.description" class="searchable" xml:space="preserve">
          ${wiki_to_html(context, ticket.description, escape_newlines=preserve_newlines)}
        </div>
        <br py:if="not ticket.description" style="clear: both" />
      </div>
    </div>
  </fieldset>
  <!--! End of ticket box -->

  <form py:if="not version and version != 0 and
               ('TICKET_APPEND' in perm(ticket.resource) or
               'TICKET_CHGPROP' in perm(ticket.resource) or
               ('TICKET_CREATE' in perm(ticket.resource) and not ticket.id))"
        action="${ticket.exists and href.ticket(ticket.id) or href.newticket()}" method="post" id="propertyform">

    <fieldset id="properties">
      <div class="field-row">
        <label for="field-summary">Project Title</label>
        <input type="text" id="field-summary" name="field_summary" size="70" />
      </div>

      <div class="field-row">
        <label for="author">Initiator</label>
        <input type="text" id="author" name="author" value="$author_id" size="70"/>
      </div>

      <div class="field-row">
        <label for="field-cc">Advocates</label>
        <input type="text" id="field-cc" title="Space or comma delimited email addresses and usernames are accepted." size="70" name="field_cc" />
      </div>
        
      <div class="field-row">
        <label for="field-description">What is the purpose of this project?</label>
        <textarea id="field-description" name="field_description"
                  class="wikitext" rows="10" cols="70"
                  py:content="ticket.description"></textarea>
      </div>

      <div class="field-row">
        <label for="field-audience">Who is this project for? What is its audience?</label>
        <textarea id="field-audience" name="field_audience" cols="70" rows="10" class="wikitext"></textarea>
      </div>
      
      <div class="field-row">
        <label for="field-why">How is this project relevant to TOPP now?</label>
        <textarea id="field-why" name="field_why" cols="70" rows="10" class="wikitext"></textarea>

      </div>
      
      <fieldset>
        <legend>Effort Estimation</legend>

        <div class="field-row">
          <label class="inline" for="field_consumer">This project is:</label>
          <input class="inline" type="radio" name="field_consumer" value="internal" />
          internal
          <input class="inline" type="radio" name="field_consumer" value="external" />
          external
        </div>

        <div class="field-row">
          <label class="inline" for="field_timeestimate">This project will take:</label>

          <input class="inline" type="radio" name="field_timeestimate" value="about a week" />
          about a week

          <input class="inline" type="radio" name="field_timeestimate" value="under a month" />
          under a month

          <input class="inline" type="radio" name="field_timeestimate" value="a month or two" />
          a month or two

          <input class="inline" type="radio" name="field_timeestimate" value="several months" />
          several months

          <input class="inline" type="radio" name="field_timeestimate" value="over a year" />

          over a year
        </div>

        <div class="field-row">
          <label class="inline" for="field_people">People this project will need:</label>
          <textarea id="field-people" name="field_people"
                    class="wikitext" rows="10" cols="70"></textarea>
        </div>

        <div class="field-row">
          <label class="inline" for="field_risks">Risks</label>
          <textarea id="field-risks" name="field_risks"
                    class="wikitext" rows="10" cols="70"></textarea>
        </div>

        <div class="field-row">
          <label class="inline" for="field_research">Any further research you would like to include</label>
          <textarea id="field-research" name="field_research"
                    class="wikitext" rows="10" cols="70"></textarea>
        </div>

      </fieldset>

    </fieldset>
    
    <p py:if="'ATTACHMENT_CREATE' in perm(ticket.resource.child('attachment'))">
      <label>
        <input type="checkbox" name="attachment" checked="${'attachment' in req.args or None}" />
        I have files to attach to this ticket
      </label>
    </p>
    <div class="buttons">
      <input type="hidden" name="field_status" value="new" />
      <input type="submit" name="preview" value="${_('Preview')}" accesskey="r" />&nbsp;
      <input type="submit" name="submit" value="${ticket.exists and 'Submit changes' or 'Create ticket'}" />
    </div>

  </form>

  <div id="help">
    <strong>Note:</strong> See
    <a href="${href.wiki('TracTickets')}">TracTickets</a> for help on using
    tickets.
  </div>
</div>

</html>
