<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:py="http://genshi.edgewall.org/">
  <xi:include href="layout.html"/>
  <head>
    <link type="text/css" href="${href.chrome('watchlist','css','style.css')}" rel="stylesheet" />
    <link type="text/css" href="${href.chrome('watchlist','css','tablesorter.css')}" rel="stylesheet" />
    <title>Watchlist</title>
    <meta py:if="version" name="ROBOTS" content="NOINDEX, NOFOLLOW" />
    <script type="text/javascript" 
      src="${href.chrome('watchlist','js','jquery.tablesorter.min.js')}"></script>
    <script type="text/javascript" 
      src="${href.chrome('watchlist','js','jquery.tablesorter.pager.js')}"></script>
    <script type="text/javascript" 
      src="${href.chrome('watchlist','js','watchlist.js')}"></script>
    <script type="text/javascript">
       // <![CDATA[
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor("Link to this section");
        });
      jQuery(document).ready(function() {
          $("#wikilist").tablesorter({ widthFixed: true, headers: { 4: { sorter: false }, 5: { sorter: false }, 6: { sorter: false } } }).tablesorterPager({container: $("#wikipager")}); 
          $("#ticketlist").tablesorter({ widthFixed: true, headers: { 4: { sorter: false } } }).tablesorterPager({container: $("#ticketpager")});
        });
       // ]]>
    </script>
    <py:def function="link(realm, resid, text='')">
        <a href="${href(realm,resid)}">${text or ":".join([realm,resid])}</a>
    </py:def>
    <py:def function="slink(realm, resid, text='')">
        <a href="${href(realm,resid)}">${text or resid}</a>
    </py:def>
  </head>

  <body>
    <div id="content" class="watchlist">
        <py:def function="ackmsg">
              <input id="ackmsg" type="button" value="Ok" />
        </py:def>
        <py:def function="unwatchicon">
          <img src="${href.chrome('watchlist/ico/unwatch.png')}" width="14px"
            height="14px" title="Unwatch" alt="Unwatch" />
        </py:def>
        <py:def function="notifybox(realm,name,notifyon)">
          <py:choose test="">
            <a class="notifyon plainlink" py:when="notifyon" 
              href="${href.watchlist(action='notifyoff',realm=realm,resid=name)}">
              <input checked="checked" type="checkbox" name="$name" />
            </a>
            <a class="notifyoff plainlink" py:otherwise="" 
              href="${href.watchlist(action='notifyon',realm=realm,resid=name)}">
              <input type="checkbox" name="$name" />
            </a>
          </py:choose>
        </py:def>
        <py:def function="tablepager(name)">
          <div class="tablesorterPager" id="$name">
            <form action="">
              <div>
              <img class="first" alt="|&lt;" src="${href.chrome('watchlist/ico/first.png')}"/>
              <img class="prev" alt="&lt;&lt;" src="${href.chrome('watchlist/ico/prev.png')}"/>
              <input type="text" class="pagedisplay"/>
              <img class="next" alt="&gt;&gt;" src="${href.chrome('watchlist/ico/next.png')}"/>
              <img class="last" alt="&gt;|" src="${href.chrome('watchlist/ico/last.png')}"/>
              <select class="pagesize">
                <option value="10" selected="selected">10</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="40">40</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="1000000">All</option>
              </select>
              </div>
            </form>
          </div>
        </py:def>

        <h1 id="top"><a href="${href.watchlist()}">Watchlist</a></h1>
        <div py:if="show_messages and action" py:choose="action" id="message-box">
            <py:when test="'watch'">
                <div class="system-message" id="error" py:if="err_res or err_pat">
                    <h3 class="system-message-title">Not found</h3>
                    <div py:if="err_res" class="err_res">
                      <p>The following selected ${realm}s where not found and could therefore not be added to the watchlist:</p>
                      <ul><li py:for="res in err_res">$res</li></ul>
                    </div>
                    <div py:if="err_pat" class="err_pat">
                      <p>The following patterns did not result in any matches:</p>
                      <ul><li py:for="pat in err_pat">$pat</li></ul>
                    </div>
                    <p class="ackmsg">${ackmsg()}</p>
                </div>
                <div class="system-message" id="warning" py:if="len(alw_res)==1">
                    <h3 class="system-message-title">Already watched</h3>
                    <p>Selected ${link(realm,alw_res[0])} is already watched.
                    (<a href="${href.watchlist(action='unwatch',realm=realm,resid=alw_res[0])}">Unwatch it?</a>)
                    ${ackmsg()}
                    </p>
                </div>
                <div class="system-message" id="warning" py:if="len(alw_res)>1">
                    <h3 class="system-message-title">Already on Watchlist</h3>
                    <p>The following selected ${realm}s where already on the watchlist:</p>
                    <ul><li py:for="res in alw_res">${slink(realm,res)}</li></ul>
                    <p class="ackmsg">${ackmsg()}</p>
                </div>
                <div class="system-message" id="notice" py:if="len(new_res)==1">
                    <h3 class="system-message-title">Added to Watchlist</h3>
                    <p>The selected ${link(realm,new_res[0])} was added to the watchlist.
                    (<a href="${href.watchlist(action='unwatch',realm=realm,resid=new_res[0])}">Remove again</a>)
                    ${ackmsg()}
                    </p>
                </div>
                <div class="system-message" id="notice" py:if="len(new_res)>1">
                    <h3 class="system-message-title">Added to Watchlist</h3>
                    <p>The following selected ${realm}s where added to the watchlist:</p>
                    <ul><li py:for="res in new_res">${slink(realm,res)}</li></ul>
                    <p class="ackmsg">${ackmsg()}</p>
                </div>
            </py:when>
            <py:when test="'unwatch'">
                <div class="system-message" id="notice" py:if="del_res">
                    <h3 class="system-message-title">Removed from Watchlist</h3>
                    <p>The following selected ${realm}s where removed from the watchlist:</p>
                    <ul><li py:for="res in del_res">${slink(realm,res)}</li></ul>
                    <p class="ackmsg">${ackmsg()}</p>
                </div>
                <div class="system-message" id="warning" py:if="err_res or err_pat">
                    <h3 class="system-message-title">Not on Watchlist</h3>
                    <div py:if="err_res" class="err_res">
                      <p>The following to-be-deleted ${realm}s where not on the watchlist:</p>
                      <ul><li py:for="res in err_res">${slink(realm,res)}</li></ul>
                    </div>
                    <div py:if="err_pat" class="err_pat">
                      <p>The following patterns did not result in any matches in the watchlist:</p>
                      <ul><li py:for="res in err_pat">$res</li></ul>
                    </div>
                    <p class="ackmsg">${ackmsg()}</p>
                </div>
            </py:when>
        </div>
    <xi:include href="wl-${realm}.html" py:for="realm in realms" />


    <div id="settings">
      <div>
        <span class="showhide"></span>
        <h2>Settings</h2>
        <form action="${href.watchlist()}" method="get">
          <div>
            <input type="hidden" name="action" value="settings" />
            <input type="checkbox" name="autonotify" value="1"
            checked="${user_settings.get('autonotify')}" />
            Auto Notify (${user_settings.autonotify})<br />
            <input type="checkbox" name="notifications" value="1"
            checked="${user_settings.get('notifications')}" />
            Notifications <br />
            <br />
            ${str(user_settings)}
            <input type="submit" value="Save" />
            <input type="reset" />
          </div>
        </form>
      </div>
    </div>

    </div>
  </body>
</html>
