= 传票变化的邮件提醒 =
[[ZhTracGuideToc]]

Trac支持通过邮件来提醒传票的变化.

邮件提醒对于让用户时刻了解传票很有帮助, 并且提拱了一个发送所有的传票变化到一个特定邮件列表的便捷方法. 例如, 这是如何创建[http://lists.edgewall.com/archive/trac-tickets/ Trac传票]邮件列表的描述.

默认情况下提醒是禁用的, 可以在[wiki:ZhTracIni trac.ini]中启用并进行配置.

== 接收提醒邮件 ==
When reporting a new ticket or adding a comment, enter a valid email address in the ''reporter'', ''assigned to/owner'' or ''cc'' field. Trac will automatically send you an email when changes are made to the ticket (depending on how notification is configured).

This is useful to keep up-to-date on an issue or enhancement request that interests you.

== Configuring SMTP Notification ==

=== Configuration Options ===
These are the available options for the ''[notification]'' section in trac.ini.
 * '''smtp_enabled''': Enable email notification.
 * '''smtp_server''': SMTP server used for notification messages.
 * '''smtp_port''': (''since 0.9'') Port used to contact the SMTP server.
 * '''smtp_user''': (''since 0.9'') User name for authentication SMTP account.
 * '''smtp_password''': (''since 0.9'') Password for authentication SMTP account.
 * '''smtp_from''': Email address to use for ''Sender''-headers in notification emails.
 * '''smtp_replyto''': Email address to use for ''Reply-To''-headers in notification emails.
 * '''smtp_default_domain''': (''since 0.10'') Append the specified domain to addresses that do not contain one. Fully qualified addresses are not modified. The default domain is appended to all username/login for which an email address cannot be found from the user settings.
 * '''smtp_always_cc''': List of email addresses to always send notifications to. ''Typically used to post ticket changes to a dedicated mailing list.''
 * '''smtp_always_bcc''': (''since 0.10'') List of email addresses to always send notifications to, but keeps addresses not visible from other recipients of the notification email 
 * '''smtp_subject_prefix''': (''since 0.10.1'') Text that is inserted before the subject of the email. Set to "!__default!__" by default.
 * '''always_notify_reporter''':  Always send notifications to any address in the reporter field (default: false).
 * '''always_notify_owner''': (''since 0.9'') Always send notifications to the address in the owner field (default: false).
 * '''always_notify_updater''': (''since 0.10'') Always send a notification to the updater of a ticket (default: true).
 * '''use_public_cc''': (''since 0.10'') Addresses in To: (owner, reporter) and Cc: lists are visible by all recipients (default is ''Bcc:'' - hidden copy).
 * '''use_short_addr''': (''since 0.10'') Enable delivery of notifications to addresses that do not contain a domain (i.e. do not end with ''@<domain.com>'').This option is useful for intranets, where the SMTP server can handle local addresses and map the username/login to a local mailbox. See also `smtp_default_domain`. Do not use this option with a public SMTP server. 
 * '''use_tls''': (''since 0.10'') Toggle to send notifications via a SMTP server using [http://en.wikipedia.org/wiki/Transport_Layer_Security TLS], such as GMail.
 * '''mime_encoding''': (''since 0.10'') E-mail notifications are always sent in 7-bit mode. This option allows to select the MIME encoding scheme. Supported values:
   * `base64`: default value, works with any kind of content. May cause some issues with touchy anti-spam/anti-virus engines.
   * `qp` or `quoted-printable`: best for european languages (more compact than base64), not recommended for non-ASCII text (less compact than base64)
   * `none`: no encoding. Use with plain english only (ASCII). E-mails with non-ASCII chars won't be delivered. 

Either '''smtp_from''' or '''smtp_replyto''' (or both) ''must'' be set, otherwise Trac refuses to send notification mails.

== 配置SMTP提醒 ==

{{{
[notification]
smtp_enabled = true
smtp_server = mail.example.com
smtp_from = notifier@example.com
smtp_replyto = myproj@projects.example.com
smtp_always_cc = ticketmaster@example.com, theboss+myproj@example.com
}}}

== 邮件样例 ==
{{{
#42: testing
---------------------------+------------------------------------------------
       Id:  42             |      Status:  assigned                
Component:  report system  |    Modified:  Fri Apr  9 00:04:31 2004
 Severity:  major          |   Milestone:  0.9                     
 Priority:  lowest         |     Version:  0.6                     
    Owner:  anonymous      |    Reporter:  jonas@example.com               
---------------------------+------------------------------------------------
Changes:
  * component:  changset view => search system
  * priority:  low => highest
  * owner:  jonas => anonymous
  * cc:  daniel@example.com =>
         daniel@example.com, jonas@example.com
  * status:  new => assigned

Comment:
I'm interested too!

--
Ticket URL: <http://example.com/trac/ticket/42>
My Project <http://myproj.example.com/>
}}}

== Filtering notifications for one's own changes ==
In Gmail, use the filter:

{{{
from:(<smtp_from>) (("Reporter: <username>" -Changes) OR "Changes (by <username>)")
}}}

to delete these notifications.

== Troubleshooting ==

如果你不能发送提醒, 首先要确定是否启用了日志, 然后查看日志是否有任何错误信息被记录. 关于日志特征的帮助, 请参考[ZhTracLogging Trac日志].

由于邮件提醒的错误不能通过Web界面报告, 所以提交修改或者创建传票的用户无法知道发送邮件提醒失败. Trac管理者需要查看日志, 找到错误的的踪迹.

=== ''拒绝访问''的错误 ===

典型的错误信息:
{{{
  ...
  File ".../smtplib.py", line 303, in connect
    raise socket.error, msg
  error: (13, 'Permission denied')
}}}

该错误通常来自服务器上的安全设置, 许多Linux发行版不允许Web服务器将邮件的信息发送到本地的SMTP服务器.

当用户手动尝试连接SMTP服务器取得成功的时候, 他们会很困惑:
{{{
telnet localhost 25
}}}

问题是, 一个正常用户能连接到SMTP服务器上, 但是Web服务器却不能:
{{{
sudo -u www-data telnet localhost 25
}}}

因此, 需要配置你的服务器, 使Web服务器被授权通过SMTP服务器发送邮件. 实际的设置取决于你的Linux发行版和现行的安全策略. 浏览Trac邮件列表文件以获得帮助.

相关邮件列表论坛:
 * [http://article.gmane.org/gmane.comp.version-control.subversion.trac.general/7518 SELinux]
 
=== ''可疑垃圾邮件''错误 ===

一些SMTP服务器可能会拒绝Trac发送的提醒邮件.

默认的Trac配置使用Base64编码来发送邮件给收件人. 邮件的整个正文部分都是编码的, 有时会触发对敏感的邮件服务器的''假阳性''垃圾邮件监控. 因此, 建议使用`mime_encoding`选项将编码改为"quoted-printable".

"Quoted-printable"编码与使用拉丁语字符集的语言配合很好. 对于亚洲字符集, 建议坚持Base64编码.

----
原文版本: TracNotification[[BR]]
相关信息: [ZhTracTickets Trac传票], [ZhTracIni Trac配置], [ZhTracGuide Trac导览][[BR]]
See also: TracTickets, TracIni, TracGuide
